buildImage-job:
  variables:
    NEXT_PUBLIC_SERVER_URL: $DEV_NEXT_PUBLIC_SERVER_URL
  rules:
    - if: $CI_COMMIT_BRANCH == 'main'
      variables:
        NEXT_PUBLIC_SERVER_URL: $PROD_NEXT_PUBLIC_SERVER_URL
    - if: $CI_COMMIT_BRANCH == 'dev' || $CI_COMMIT_BRANCH == 'feature/hotfixes'
      variables:
        NEXT_PUBLIC_SERVER_URL: $DEV_NEXT_PUBLIC_SERVER_URL
  image: docker:20
  stage: package
  before_script:
    - docker login $CI_REGISTRY -u $CI_REGISTRY_USER -p $CI_REGISTRY_PASSWORD
  script:
    - echo "Building the image"
    - docker buildx build --build-arg NEXT_PUBLIC_SERVER_URL=$NEXT_PUBLIC_SERVER_URL -t $CI_REGISTRY_IMAGE:$CI_COMMIT_REF_SLUG --push .
